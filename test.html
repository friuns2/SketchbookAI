<script src="https://unpkg.com/acorn/dist/acorn.js"></script>
<script src="https://unpkg.com/acorn-walk/dist/walk.js"></script>
<script src="test2.js">
    function takeSnapshot(code, context) {
        const ast = acorn.parse(code, { ecmaVersion: 2020 });
        const modifiedVariables = [];

        acorn.walk.simple(ast, {
            CallExpression(node) {
                if (node.callee.type === 'MemberExpression') {
                    modifiedVariables.push(node.callee.object.name);
                }
            },
            AssignmentExpression(node) {
                if (node.left.type === 'Identifier') {
                    modifiedVariables.push(node.left.name);
                }
            },
        });

        const snapshot = {};
        modifiedVariables.forEach(variable => {
            snapshot[variable] = Array.isArray(context[variable])
                ? [...context[variable]]
                : context[variable];
        });

        return snapshot;
    }

    function undo(snapshot, context) {
        Object.entries(snapshot).forEach(([variable, value]) => {
            context[variable] = value;
        });
    }

    // Example usage
    var test = [];
    var test2 = 1;
    let code = "test.push(1);test2=test2+1;";
    const snapshot = takeSnapshot(code, window);
    eval(code);
    console.log(test); // Output: [1]
    console.log(test2); // Output: 2

    undo(snapshot, window);
    console.log(test); // Output: []
    console.log(test2); // Output: 1
</script>